<extend name="Public/layout"/>
<block name="content">
	<style>
		.reg{margin:50px 320px;}
		.inputs{width:280px;}
		.floatinputs{width:140px;float: left;}
		img{width: 140px;height: 32px;float: left;}
	</style>
	<div class="container">
		<h2 class="text-center h2">终点中文网<small>&nbsp;&nbsp;&nbsp;&nbsp;注册加入我们</small></h2>
		<div class="reg">
			<form class="form-horizontal" role="form" style="margin-top:40px;" action="<{:U('Reg/reg')}>" method="post">
		      <div class="form-group" >
		        <label for="Username" class="col-sm-2 control-label">用户名</label>
		        <div class="col-sm-10">
		          <input type="text" class="form-control inputs" id="Username" placeholder="请输入2~9位的用户名" name="u_username">
		        </div>
		      </div>
		      <div class="form-group">
		        <label for="inputPassword1" class="col-sm-2 control-label">密码</label>
		        <div class="col-sm-10">
		          <input type="password" class="form-control inputs" id="inputPassword1" placeholder="请输入8~16位的密码"  name="u_password">
		        </div>
		      </div>
		      <div class="form-group">
		        <label for="inputPassword2" class="col-sm-2 control-label">确认密码</label>
		        <div class="col-sm-10">
		          <input type="password" class="form-control inputs" id="inputPassword2" placeholder="请再输入一遍密码" name="password2">
		        </div>
		      </div>
		      <div class="form-group">
		        <label for="inputCode" class="col-sm-2 control-label">验证码</label>
		        <div class="col-sm-10">
		          <input type="text" class="form-control floatinputs" id="inputCode" placeholder="Code" name="code" > <img src="<{:U('Reg/code')}>" alt="" id="codepic">
		        </div>
		      </div>
		      <p ><a href="#" >手机号快速注册</a></p>
		      <div class="form-group">
		        <div class="col-sm-offset-2 col-sm-10">
		          <div class="checkbox">
		            <label>
		              <input type="checkbox"> 记住我
		            </label>
		          </div>
		        </div>
		      </div>
		      <div class="form-group">
		        <div class="col-sm-offset-2 col-sm-10">
		          <button type="submit" class="btn btn-success" id="btn" disabled>注册</button>
		        </div>
		      </div>
		    </form>
		</div>
	</div>
<div style="height: 60px"></div>
<!--[if !IE]> -->
<script type="text/javascript" src="__PUBLIC__/js/jquery-2.0.3.min.js"></script>

<!--<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>-->

<!-- <![endif]-->

<!--[if IE]>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<![endif]-->

<!--[if !IE]> -->

<script type="text/javascript">
	window.jQuery || document.write("<script src='__PUBLIC__/ace/assets/js/jquery-2.0.3.min.js'>"+"<"+"/script>");
</script>

<!-- <![endif]-->

<script type="text/javascript">
	if("ontouchend" in document) document.write("<script src='__PUBLIC__/ace/assets/js/jquery.mobile.custom.min.js'>"+"<"+"/script>");

	
</script>
<script type="text/javascript" src="__PUBLIC__/layer/layer.js"></script>
<script type="text/javascript" src="__PUBLIC__/layui/layui.js"></script>

<!-- inline scripts related to this page -->

<!-- 	<div style="display:none"><script src='http://v7.cnzz.com/stat.php?id=155540&web_id=155540' language='JavaScript' charset='gb2312'></script></div> -->
<script>
// 点击验证码图片刷新
var u = null;
var p = null;
var c = null;
var codepic = $('#codepic');
var src_img = codepic.attr('src');
codepic.click(function(){
    $(this).attr('src', src_img+'?yzm='+Math.random());
    console.log($(this).attr('src'));
});
//验证码ajax验证
$('#inputCode').focusout(function(){
    $.ajax({
        url:"<{:U('Reg/codetest')}>",
        data: "val="+inputCode.value,
        type:'POST',
        success:function(data){
            if(data !== 'true'){
            	//小tips
				layer.tips('验证码出错啦', '#inputCode', {
				  tips: [1, '#3595CC'],
				  time: 4000
				}); 
				$('#btn').attr('disabled','disabled');
            }else{
            	layer.tips('验证码正确', '#inputCode', {
				  tips: [1, 'lightgreen'],
				  time: 4000
				}); 
				$('#btn').attr('disabled','disabled');
				c = true;
            	// $('#btn').removeAttr('disabled');
            }
        }
    })
})

//用户名ajax验证
$('#Username').focusout(function(){
    $.ajax({
        url:"<{:U('Reg/usernametest')}>",
        data: "val="+Username.value,
        type:'POST',
        success:function(data){
        	switch(data){
        		case "null":
        			layer.tips('用户名不能为空', '#Username');
        			$('#btn').attr('disabled','disabled');
        		break;
        		case "err":
        			layer.tips('用户名格式不正确', '#Username');
        			$('#btn').attr('disabled','disabled');
        		break;
        		case "false":
        			layer.tips('用户名已存在', '#Username');
        			$('#btn').attr('disabled','disabled');
        		break;
        		case "true":
        			layer.tips('恭喜您，用户名可以使用', '#Username');
        			u = true;
        		break;
        		default:
        		break;
        	}
        }
    })
})

//密码ajax验证
$('#inputPassword2').focusout(function(){
    $.ajax({
        url:"<{:U('Reg/passwordtest')}>",
        data: "val1="+inputPassword1.value+"&val2="+inputPassword2.value,
        type:'POST',
        success:function(data){
            switch(data){
        		case "null1":
        			layer.tips('密码不能为空', '#inputPassword1');
        			$('#btn').attr('disabled','disabled');
        		break;
        		case "null2":
        			layer.tips('密码不能为空', '#inputPassword2');
        			$('#btn').attr('disabled','disabled');
        		break;
        		case "err":
        			layer.tips('密码格式不正确', '#inputPassword2');
        			$('#btn').attr('disabled','disabled');
        		break;
        		case "false":
        			layer.tips('两次密码不一致', '#inputPassword2');
        			$('#btn').attr('disabled','disabled');
        		break;
        		case "true":
        			layer.tips('密码可以使用', '#inputPassword2');
        			p = true;
        		break;
        		default:
        		break;

        	}
        }
    })
})

//判断是否全部正确
setInterval(demo,100);
function demo(){
	if(u == true && p == true && c == true){
		$('#btn').removeAttr('disabled');
	}else{
		$('#btn').attr('disabled','disabled');
	}
}



$('#btn').click(function(){
	//加载层
	var index = layer.load(0, {shade: false}); //0代表加载的风格，支持0-2

})
</script>
</block>