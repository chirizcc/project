<extend name="Center/public"/>
<block name="content">
    <style>
        .reg {
            margin: 50px 320px;
        }

        .inputs {
            width: 280px;
        }

        .floatinputs {
            width: 140px;
            float: left;
        }

        img {
            width: 140px;
            height: 32px;
            float: left;
        }
      
    </style>

    <div class="container" >
        <h2 class="text-center h2">修改密码
            <small>&nbsp;&nbsp;&nbsp;&nbsp;</small>
        </h2>
    <div class="row" >
            <div class="col-md-6 col-md-offset-3">
                <div class="layui-tab layui-tab-card" >
                    <ul class="layui-tab-title">
                        <li class="layui-this">手机号修改</li>
                        <li>邮箱修改</li>
                    </ul>
                    <div class="layui-tab-content">
                        <!-- 手机 -->
                        <div class="layui-tab-item layui-show">
                             <div class="row">
                                <div class="col-md-10 col-md-offset-2">
                                    <form action="<{:U('Home/Reset/res')}>" method="post"
                                          class="layui-form layui-form-pane" onsubmit="return judged()">
                                        <div class="layui-form-item">
                                            <label class="layui-form-label">手机号</label>
                                            <div class="layui-input-inline">
                                                <input name="username" lay-verify="phone" value="<{$data.det_tel}>"
                                                       autocomplete="off" class="layui-input" type="text" id="username" readonly>
                                            </div>
                                        </div>
                                        <div class="layui-form-item">
                                            <label class="layui-form-label">新密码</label>
                                            <div class="layui-input-inline">
                                                <input name="u_password" lay-verify="pass" placeholder="请输入密码"
                                                       autocomplete="off" class="layui-input" type="password" id="passwd1">
                                            </div>
                                        </div>

                                        <div class="layui-form-item">
                                            <label class="layui-form-label">确认密码</label>
                                            <div class="layui-input-inline">
                                                <input name="u_password2" lay-verify="pass" placeholder="请确认密码"
                                                       autocomplete="off" class="layui-input" type="password" id="passwd2">
                                            </div>
                                        </div>

                                        <div class="layui-form-item">
                                            <label class="layui-form-label">手机验证码</label>
                                            <div class="layui-input-inline">
                                                <input name="phonecode" lay-verify="required" placeholder="请输入验证码"
                                                       autocomplete="off" class="layui-input" type="text" id="phonecode">
                                            </div>
                                            <div class="code"><button class="btn btn-success" id="sendMessage">发送验证码</button></div>
                                        </div>

                                        <div class="layui-form-item">
                                            <div class="layui-input-block">
                                                <button class="layui-btn layui-btn-big" lay-submit lay-filter="*">确定修改
                                                </button>
                                            </div>
                                        </div>

                                        <style>
                                            .layui-form-pane .layui-form-label {
                                                width: 100px;
                                            }

                                            .code img {
                                                height: 37px;
                                                border: 1px solid #E6E6E6;
                                            }
                                        </style>
                                    </form>
                                </div>
                            </div>                           
                        </div>
                        <!-- 邮箱 -->
                        <div class="layui-tab-item">
                            <div class="row">
                                <div class="col-md-10 col-md-offset-2">
                                    <form action="<{:U('Home/Reset/emailReset')}>" method="post"
                                          class="layui-form layui-form-pane" onsubmit="return judge()">
                                        <div class="layui-form-item">
                                            <label class="layui-form-label">邮箱</label>
                                            <div class="layui-input-inline">
                                           
                                                <input name="u_username" lay-verify="email" value="<{$data.det_email}>" 
                                                       autocomplete="off" class="layui-input" type="text" id="username1" readonly>
                                            </div>
                                        </div>

                                        <div class="layui-form-item">
                                            <label class="layui-form-label">密码</label>
                                            <div class="layui-input-inline">
                                                <input name="u_password" lay-verify="pass" placeholder="请输入密码"
                                                       autocomplete="off" class="layui-input" type="password" id="pwd1">
                                            </div>
                                        </div>

                                        <div class="layui-form-item">
                                            <label class="layui-form-label">确认密码</label>
                                            <div class="layui-input-inline">
                                                <input name="u_password2" lay-verify="pass" placeholder="请确认密码"
                                                       autocomplete="off" class="layui-input" type="password" id="pwd2">
                                            </div>
                                        </div>
                                        <div class="layui-form-item">
                                            <div class="layui-input-block">
                                                <button class="layui-btn layui-btn-big" lay-submit lay-filter="*">确定修改
                                                </button>
                                            </div>
                                        </div>

                                        <style>
                                            .layui-form-pane .layui-form-label {
                                                width: 100px;
                                            }

                                            .code img {
                                                height: 37px;
                                                border: 1px solid #E6E6E6;
                                            }
                                        </style>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div style="height: 60px"></div>
    <!--[if !IE]> -->
    <script type="text/javascript" src="__PUBLIC__/js/jquery-2.0.3.min.js"></script>

    <!-- <![endif]-->


    <!--[if !IE]> -->

    <script type="text/javascript">
        window.jQuery || document.write("<script src='__PUBLIC__/ace/assets/js/jquery-2.0.3.min.js'>" + "<" + "/script>");
    </script>

    <!-- <![endif]-->

    <script type="text/javascript">
        if ("ontouchend" in document) document.write("<script src='__PUBLIC__/ace/assets/js/jquery.mobile.custom.min.js'>" + "<" + "/script>");
    </script>
    <script type="text/javascript" src="__PUBLIC__/layer/layer.js"></script>
    <script type="text/javascript" src="__PUBLIC__/layui/layui.js"></script>
    <script>
       
        var vCode = 0;
        var m = 60;
        var timer = null;
        var v = null;

        layui.use('element', function () {
            var element = layui.element();

        });

        $('#codepic').click(function () {
            $(this).attr('src', $('#codepic').attr('src') + '?yzm=' + Math.random());
        });

        layui.use('form', function () {
            var form = layui.form();

            form.verify({
                pass: [
                    /((?=.*\d)(?=.*\D)|(?=.*[a-zA-Z])(?=.*[^a-zA-Z]))^.{8,16}$/
                    , '密码必须8到16位，数字、字母、字符至少包含两种'
                ]
            });

        });

        function judge() {
            var pwd1 = $('#pwd1').val();
            var pwd2 = $('#pwd2').val();
            if (pwd1 != pwd2) {
                layui.use('layer', function () {
                    var layer = layui.layer;
                    layer.tips('新密码与确认密码不相同', '#pwd2');
                });
                return false ;
            }
            
               return true ;
                      
        }

        function judged() {
            var pwd1 = $('#passwd1').val();
            var pwd2 = $('#passwd2').val();
            if (pwd1 != pwd2) {
                layui.use('layer', function () {
                    var layer = layui.layer;
                    layer.tips('新密码与确认密码不相同', '#passwd2');
                });
                return false
            }

            // console.log(vCode);
            // console.log(vName);
            if (vCode == 1) {
                return true ;
            }

            return false;
        }

 

        $('#code').blur(function () {
            var code = $('#code').val();
            $.post('<{:U("Home/Reset/codetest")}>', {'val': code}, function (data) {
                if (data != true) {
                    layui.use('layer', function () {
                        var layer = layui.layer;
                        layer.tips('验证码不正确!', '#code', {tips: [1, '#0FA6D8']});
                    });
                    vCode = 0;
                } else {
                    vCode = 1;
                }
            });
        });

        //手机号码ajax验证
        $('#sendMessage').click(function () {
            // console.log($('#username').val());
            $.ajax({
                url: "<{:U('Reset/sendSms')}>",
                data: "val=" + $('#username').val(),
                type: 'POST',
                success: function (data) {
                    if(data == 'err'){
                         layer.tips('手机号不正确!', '#username', {tips: [1, '#0FA6D8']});
                    }else{
                        v = data;
                        // console.log(data); 
                        $('#sendMessage').attr('disabled','disabled');
                        $('#sendMessage').html('60秒后重新发送');
                        timer = setInterval(demo,1000);
                    }
                }
            })
        }) 

        //定时函数
        function demo(){
            if(m<0){
                clearInterval(timer);
                $('#sendMessage').removeAttr('disabled');
                $('#sendMessage').html('发送验证码');
                m=60;
                return;
            }

            $('#sendMessage').html(m+'秒后重新发送');
            m --;    
            
        }   

        //判断验证码是否一致
        $('#phonecode').blur(function () {
            if(v == $('#phonecode').val()){
                vCode = 1;
                layer.tips('恭喜，验证码正确', '#phonecode');
            }else{
                vCode = 0;
                layer.tips('验证码不正确!', '#phonecode', {tips: [1, '#0FA6D8']});
            }
        })
         
    </script>

    </block>
